<div class="worldinfo-viewer-popup">
    <h3>已觸發的世界書條目</h3>
    <hr>

    {{! 只有當任何一個分類有內容時，才顯示下面的區塊 }}
    {{#if (or global.length character.length chat.length other.length)}}

        {{#if global.length}}
        <div class="wi-category">
            <h4><span class="wi-emoji">🌍</span> 全域世界書</h4>
            {{#each global}}
            <div class="wi-entry">
                <div class="wi-entry-header">
                    <span class="wi-emoji">{{emoji}}</span>
                    <span class="wi-title">{{worldName}} / {{entryName}}</span>
                </div>
                <div class="wi-entry-info">
                    {{#if keys}}
                    <div class="wi-info-item"><strong>主關鍵字：</strong><span>{{keys}}</span></div>
                    {{/if}}
                    {{#if secondaryKeys}}
                    <div class="wi-info-item"><strong>過濾器：</strong><span>{{secondaryKeys}}</span></div>
                    {{/if}}
                    <div class="wi-info-item"><strong>插入位置：</strong><span>{{position}}</span></div>
                </div>
                <div class="wi-entry-content">
                    <strong>內容：</strong>
                    <pre>{{content}}</pre>
                </div>
            </div>
            {{/each}}
        </div>
        {{/if}}

        {{#if character.length}}
        <div class="wi-category">
            <h4><span class="wi-emoji">👤</span> 角色主要知識書</h4>
            {{#each character}}
            <div class="wi-entry">
                <div class="wi-entry-header">
                    <span class="wi-emoji">{{emoji}}</span>
                    <span class="wi-title">{{worldName}} / {{entryName}}</span>
                </div>
                <div class="wi-entry-info">
                    {{#if keys}}
                    <div class="wi-info-item"><strong>主關鍵字：</strong><span>{{keys}}</span></div>
                    {{/if}}
                    {{#if secondaryKeys}}
                    <div class="wi-info-item"><strong>過濾器：</strong><span>{{secondaryKeys}}</span></div>
                    {{/if}}
                    <div class="wi-info-item"><strong>插入位置：</strong><span>{{position}}</span></div>
                </div>
                <div class="wi-entry-content">
                    <strong>內容：</strong>
                    <pre>{{content}}</pre>
                </div>
            </div>
            {{/each}}
        </div>
        {{/if}}

        {{#if chat.length}}
        <div class="wi-category">
            <h4><span class="wi-emoji">💬</span> 角色聊天知識書</h4>
            {{#each chat}}
            <div class="wi-entry">
                <div class="wi-entry-header">
                    <span class="wi-emoji">{{emoji}}</span>
                    <span class="wi-title">{{worldName}} / {{entryName}}</span>
                </div>
                <div class="wi-entry-info">
                    {{#if keys}}
                    <div class="wi-info-item"><strong>主關鍵字：</strong><span>{{keys}}</span></div>
                    {{/if}}
                    {{#if secondaryKeys}}
                    <div class="wi-info-item"><strong>過濾器：</strong><span>{{secondaryKeys}}</span></div>
                    {{/if}}
                    <div class="wi-info-item"><strong>插入位置：</strong><span>{{position}}{{#if depth}} / 深度 {{depth}}{{/if}}</span></div>
                </div>
                <div class="wi-entry-content">
                    <strong>內容：</strong>
                    <pre>{{content}}</pre>
                </div>
            </div>
            {{/each}}
        </div>
        {{/if}}

        {{#if other.length}}
        <div class="wi-category">
            <h4><span class="wi-emoji">📦</span> 其他</h4>
            {{#each other}}
            <div class="wi-entry">
                <div class="wi-entry-header">
                    <span class="wi-emoji">{{emoji}}</span>
                    <span class="wi-title">{{worldName}} / {{entryName}}</span>
                </div>
                <div class="wi-entry-info">
                     <div class="wi-info-item"><strong>插入位置：</strong><span>{{position}}</span></div>
                </div>
                <div class="wi-entry-content">
                    <strong>內容：</strong>
                    <pre>{{content}}</pre>
                </div>
            </div>
            {{/each}}
        </div>
        {{/if}}

    {{else}}
        <div class="wi-no-entries">
            <p>ℹ️ 沒有偵測到任何觸發的世界書條目。</p>
        </div>
    {{/if}}
</div>
